<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animación Araña 2D - Profesional V3</title>
    <style>
        :root {
            /* Paleta de colores mejorada para contraste */
            --color-abdomen: #111111;   /* Negro casi puro */
            --color-thorax: #3a3a3a;    /* Gris carbón para la cabeza */
            --color-legs: #222222;      /* Gris muy oscuro para patas */
            --color-eye: #ff0000;       /* Rojo brillante */
            /* Borde sutil para definir las patas contra el cuerpo */
            --leg-definition: 1px solid rgba(0,0,0,0.8);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            cursor: pointer;
        }

        #scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* Fondo dividido estilo "flat design" */
            background: linear-gradient(to top, #d0d0d0 45%, #e8e8e8 45%);
        }

        .spider-rig {
            position: absolute;
            top: 45%; /* Posicionado en la línea del suelo */
            left: 50%;
            z-index: 2;
            /* El punto de transformación es el centro inferior (entre las patas) */
            transform: translate(-50%, -100%);
        }

        /* --- ESTRUCTURA DEL CUERPO --- */
        .body-container {
             position: relative;
             /* Z-index medio: Las patas traseras van detrás, las delanteras delante */
             z-index: 10; 
        }

        /* Tórax (Cabeza/Pecho) */
        .thorax {
            position: absolute;
            width: 48px;
            height: 40px;
            background-color: var(--color-thorax);
            /* Forma más redondeada en el frente */
            border-radius: 45% 50% 50% 45%;
            top: 15px;
            left: -22px;
            z-index: 12; /* Delante del abdomen */
            box-shadow: inset 0 -2px 5px rgba(0,0,0,0.5); /* Sombra interna sutil para volumen */
        }

        /* Abdomen (Parte trasera) */
        .abdomen {
            position: absolute;
            width: 90px;
            height: 80px;
            background-color: var(--color-abdomen);
            border-radius: 50% 55% 50% 50%;
            top: 0px;
            left: 5px;
            z-index: 11;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,1); /* Volumen extra oscuro */
        }
        
        /* Ojo */
        .eye-profile {
            position: absolute;
            width: 7px;
            height: 7px;
            background: var(--color-eye);
            border-radius: 50%;
            top: 12px;
            left: 6px;
            box-shadow: 0 0 8px var(--color-eye); /* Resplandor rojo */
        }

        /* Colmillos (Corregidos: posición y tamaño) */
        .fangs {
            position: absolute;
            /* Ajustados para estar pegados debajo del frente del tórax */
            top: 28px; 
            left: -4px;
            z-index: 10; /* Detrás del tórax pero delante de las patas de fondo */
        }
        .fang {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            /* Colmillos más cortos y afilados */
            border-top: 12px solid var(--color-abdomen);
            transform-origin: top center;
        }
        .fang1 { left: 0px; transform: rotate(10deg); }
        .fang2 { left: 7px; transform: rotate(0deg); }


        /* --- PATAS (Con definición mejorada) --- */
        /* Contenedores para profundidad 3D */
        .legs-back {
            position: absolute;
            top: 38px; /* Punto de nacimiento central */
            left: 18px;
            z-index: 5; /* Lo más atrás */
            /* Oscurecer patas traseras para profundidad */
            filter: brightness(0.7) contrast(1.2); 
        }
        
        .legs-front {
            position: absolute;
            top: 38px;
            left: 18px;
            z-index: 15; /* Lo más adelante */
        }

        .leg {
            position: absolute;
            top: 0;
            transform-origin: 0 0;
        }

        /* Segmentos de pata con BORDES para definición */
        .femur {
            position: absolute;
            width: 45px;
            height: 8px;
            background-color: var(--color-legs);
            border-radius: 4px;
            border: var(--leg-definition); /* Borde clave */
            transform-origin: 4px 50%;
            left: 0;
            top: 0;
        }

        .tibia {
            position: absolute;
            width: 65px;
            height: 6px;
            background-color: var(--color-legs);
            border-radius: 3px 100% 100% 3px; /* Punta afilada */
            border: var(--leg-definition); /* Borde clave */
            transform-origin: 4px 50%;
            left: 40px;
            top: 1px;
        }

        /* Distribución de las 6 patas */
        /* Patas traseras (fondo) */
        .B1 { left: -8px; }
        .B2 { left: 12px; }
        .B3 { left: 32px; }
        /* Patas delanteras (frente) */
        .F1 { left: -2px; }
        .F2 { left: 18px; }
        .F3 { left: 38px; }

        .instructions {
            position: absolute;
            bottom: 50px;
            color: #777;
            font-family: 'Arial', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.75rem;
            width: 100%;
            text-align: center;
            opacity: 0.8;
        }
    </style>
</head>
<body>

    <div id="scene">
        <div class="spider-rig" id="spiderRig">
            
            <div class="legs-back">
                <div class="leg B1"><div class="femur"><div class="tibia"></div></div></div>
                <div class="leg B2"><div class="femur"><div class="tibia"></div></div></div>
                <div class="leg B3"><div class="femur"><div class="tibia"></div></div></div>
            </div>

            <div class="body-container">
                <div class="thorax">
                    <div class="eye-profile"></div>
                     <div class="fangs">
                        <div class="fang fang1" id="fang1"></div>
                        <div class="fang fang2" id="fang2"></div>
                    </div>
                </div>
                <div class="abdomen"></div>
            </div>

            <div class="legs-front">
                <div class="leg F1"><div class="femur"><div class="tibia"></div></div></div>
                <div class="leg F2"><div class="femur"><div class="tibia"></div></div></div>
                <div class="leg F3"><div class="femur"><div class="tibia"></div></div></div>
            </div>
        </div>
    </div>
    
    <div class="instructions">Click para atacar</div>

    <script>
        // Referencias DOM
        const spiderRig = document.getElementById('spiderRig');
        const femurs = document.querySelectorAll('.femur');
        const tibias = document.querySelectorAll('.tibia');
        const fang1 = document.getElementById('fang1');
        const fang2 = document.getElementById('fang2');

        // Variables de estado
        let time = 0;
        const speed = 0.08;
        let isAttacking = false;
        let attackPhase = 0;

        // Desfases para 6 patas. Patrón alterno trípode para estabilidad visual.
        // Grupo A: B1, B3, F2 | Grupo B: B2, F1, F3
        const legOffsets = [
            0, Math.PI, 0,           // B1, B2, B3
            Math.PI, 0, Math.PI      // F1, F2, F3
        ];

        // Ángulos base del fémur para abanicar las patas
        const baseFemurAngles = [-35, -65, -95, -25, -55, -85];

        // --- Bucle Principal ---
        function animate() {
            if (!isAttacking) {
                time += speed;
            }

            // "Bobbing" (rebote) del cuerpo más pesado
            const bodyBob = isAttacking ? 0 : Math.sin(time * 4) * 2.5;
            const attackTransform = getAttackTransform();
            
            // Aplicamos movimiento al rig completo
            spiderRig.style.transform = `translate(calc(-50% + ${attackTransform.x}px), calc(-100% + ${bodyBob + attackTransform.y}px)) rotate(${-attackTransform.rot}deg)`;

            // --- Cinemática de Patas ---
            for (let i = 0; i < 6; i++) {
                const currentPhase = time + legOffsets[i];

                // Ciclos de movimiento (swing = péndulo, lift = levantar)
                let swing = Math.cos(currentPhase); 
                let lift = Math.max(0, Math.sin(currentPhase));

                let targetFemurAngle = baseFemurAngles[i];  
                let targetTibiaAngle = 135; // Ángulo base de rodilla

                // Modificadores durante el ataque
                if (isAttacking) {
                    if (i === 0 || i === 3) { 
                        // Patas delanteras (B1 y F1) se levantan como guadañas
                        targetFemurAngle = -110 - (35 * attackPhase); 
                        targetTibiaAngle = 130 - (90 * attackPhase); 
                        swing = 0; lift = 0;
                    } else { 
                        // Las demás se agachan para estabilizar
                        targetFemurAngle += (25 * attackPhase); 
                        targetTibiaAngle += (25 * attackPhase);
                        swing = 0; lift = 0;
                    }
                }
                
                // Cálculo final aplicando los ciclos
                // Lift afecta más a la rodilla para que el pie suba recto
                const finalFemurAngle = targetFemurAngle + (swing * 22) - (lift * 20);
                const finalTibiaAngle = targetTibiaAngle - (lift * 35);

                femurs[i].style.transform = `rotate(${finalFemurAngle}deg)`;
                tibias[i].style.transform = `rotate(${finalTibiaAngle}deg)`;
            }

            requestAnimationFrame(animate);
        }

        // --- Lógica de Ataque ---
        function getAttackTransform() {
            // Estado normal de los colmillos
            if (!isAttacking) {
                fang1.style.transform = 'rotate(10deg)';
                fang2.style.transform = 'rotate(0deg)';
                return { x: 0, y: 0, rot: 0 };
            }
            
            // Movimiento del cuerpo durante el ataque
            const lungeX = 90 * attackPhase; // Estocada larga
            const lungeY = 15 * attackPhase; // Se agacha un poco
            const rotation = 12 * attackPhase; // Se inclina hacia arriba

            // Animación de los colmillos (se abren agresivamente)
            fang1.style.transform = `rotate(${10 - 50 * attackPhase}deg)`;
            fang2.style.transform = `rotate(${0 - 40 * attackPhase}deg)`;

            return { x: lungeX, y: lungeY, rot: rotation };
        }

        function triggerAttack() {
            if (isAttacking) return;
            isAttacking = true;
            attackPhase = 0;

            const attackDuration = 250; 
            const startTime = performance.now();

            // Función de easing para un ataque rápido y elástico
            function performAttackStep(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / attackDuration, 1);

                 if (progress < 0.5) {
                     // Fase de ida rápida (seno)
                     attackPhase = Math.sin(progress * Math.PI); 
                 } else {
                     // Fase de retorno con rebote suave
                      attackPhase = (1 - Math.sin((progress - 0.5) * Math.PI)) * 1.1; 
                 }

                if (progress < 1) {
                    requestAnimationFrame(performAttackStep);
                } else {
                    isAttacking = false;
                    attackPhase = 0;
                }
            }
            requestAnimationFrame(performAttackStep);
        }

        document.body.addEventListener('mousedown', triggerAttack);
        document.body.addEventListener('touchstart', triggerAttack, {passive: true});

        // Iniciar
        animate();

    </script>
</body>
</html>