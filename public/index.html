<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survival RPG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="style.css">
    <style>
        /* â”€â”€ Layout de pantalla â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        body { margin: 0; padding: 0; background: #060910; overflow: hidden; }
        #screen-wrapper {
            position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }
        #game-wrapper {
            position: relative; width: 1280px; height: 720px;
            transform-origin: center center;
        }

        /* â”€â”€ Grilla de inventario â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 45px);
            gap: 6px;
            justify-content: center;
            margin-bottom: 10px;
        }

        /* â”€â”€ Barras de label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .bar-wrapper { margin-bottom: 2px; }

        /* â”€â”€ Servidor guardados â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #saved-servers {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-height: 80px;
            overflow-y: auto;
        }
        #saved-servers::-webkit-scrollbar { width: 3px; }
        #saved-servers::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }

        /* â”€â”€ Separador decorativo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .menu-sep {
            border: none;
            border-top: 1px solid rgba(255,255,255,0.07);
            margin: 14px 0;
        }
    </style>
</head>
<body>

<div id="screen-wrapper">
    <div id="game-wrapper">

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!--  MENÃš PRINCIPAL                             -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="main-menu">
            <div class="menu-box">
                <h1 class="menu-title">SURVIVAL RPG</h1>
                <p class="menu-subtitle">Alpha Multijugador</p>

                <input type="text" id="player-name" class="menu-input"
                       placeholder="Tu nombre de supervivienteâ€¦" maxlength="15">

                <!-- Jugar solo -->
                <button id="btn-single" class="action-btn">
                    ğŸ•¹ï¸ Jugar Solo (Offline)
                </button>

                <!-- Online -->
                <div style="background: rgba(61,220,132,0.05); padding: 12px; border-radius: 8px; border: 1px solid rgba(61,220,132,0.15); margin-bottom: 12px;">
                    <button id="btn-online" class="action-btn" style="margin-bottom: 6px;">
                        ğŸŒ Jugar Online (Global)
                    </button>
                    <div id="online-url-area" style="display:none; font-size: 11px; color: #5a6475; margin-bottom: 4px; font-family: var(--font-ui);">
                        ğŸ”— <span id="current-url" style="color: #3ddc84;"></span>
                    </div>
                    <div id="server-status-badge" style="font-size: 11px; font-weight: 600; color: #f0a030; font-family: var(--font-ui); letter-spacing: 0.04em;">
                        ğŸŸ  Comprobando servidorâ€¦
                    </div>
                </div>

                <hr class="menu-sep">

                <!-- LAN -->
                <button id="btn-host" class="action-btn" style="border-color: rgba(240,160,48,0.25); color: #f0a030; text-shadow: 0 0 12px rgba(240,160,48,0.25); background: linear-gradient(180deg, rgba(28,16,4,0.92), rgba(18,10,2,0.96)); margin-bottom: 8px;">
                    ğŸ  Crear Servidor Local (LAN)
                </button>
                <div style="display: flex; gap: 8px; margin-bottom: 4px;">
                    <input type="text" id="server-ip" class="menu-input"
                           style="margin-bottom: 0; flex: 2; padding: 9px 12px;"
                           placeholder="IP del servidorâ€¦">
                    <button id="btn-join" class="action-btn"
                            style="flex: 1; margin: 0; border-color: rgba(91,180,245,0.25); color: #5bb4f5; text-shadow: 0 0 12px rgba(91,180,245,0.25); background: linear-gradient(180deg, rgba(4,14,28,0.92), rgba(2,8,18,0.96));">
                        Unirse
                    </button>
                </div>

                <!-- Servidores guardados -->
                <div id="saved-servers"></div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!--  CANVAS                                     -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <canvas id="gameCanvas" width="1280" height="720" style="display:block;"></canvas>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!--  PANTALLA DE MUERTE                         -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="death-screen" class="glass-panel"
             style="display:none; position:absolute; top:50%; left:50%;
                    transform:translate(-50%,-50%); z-index:1000;
                    text-align:center; padding: 36px 40px; min-width: 300px;">
            <h2 style="color:#e05252; font-family: var(--font-display); font-size: 1.8rem;
                       letter-spacing: 0.12em; margin-bottom: 6px; text-shadow: 0 0 30px rgba(224,82,82,0.5);">
                Â¡HAS MUERTO!
            </h2>
            <p style="color: #5a6475; font-family: var(--font-ui); font-size: 12px;
                      letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 24px;">
                El mundo sigue sin tiâ€¦
            </p>
            <div style="display:flex; gap:12px; justify-content:center;">
                <button class="action-btn"
                        style="width:auto; padding: 10px 22px; font-size: 13px;"
                        onclick="window.respawn('coast')">ğŸŒŠ Costa</button>
                <button id="btn-respawn-bed" class="action-btn"
                        style="width:auto; padding: 10px 22px; font-size: 13px;
                               border-color: rgba(180,40,40,0.35); color: #e07070;
                               background: linear-gradient(180deg, rgba(22,4,4,0.9), rgba(14,2,2,0.96));"
                        onclick="window.respawn('bed')">ğŸ›ï¸ Tu Cama</button>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!--  UI LAYER (HUD en juego)                    -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="ui-layer" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;">

            <!-- â”€â”€ ARRIBA IZQUIERDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div style="position:absolute; top:14px; left:14px; display:flex; flex-direction:column; gap:7px; z-index:200;">

                <!-- Info del servidor (sÃ³lo multijugador) -->
                <div id="server-info" style="display:none; pointer-events:auto; align-items:center; gap:8px;
                     background:rgba(5,10,16,0.92); backdrop-filter:blur(14px);
                     border:1px solid rgba(61,220,132,0.25); border-left:2px solid #3ddc84;
                     border-radius:8px; padding:7px 12px;
                     font-family:var(--font-ui); font-size:12px; font-weight:600;
                     color:var(--text-main); letter-spacing:0.03em; white-space:nowrap;">
                    <span style="color:#3ddc84;">ğŸŸ¢</span>
                    <span id="sv-ip" style="color:#3ddc84; font-weight:700;">Local</span>
                    <span style="color:rgba(255,255,255,0.2);">â”‚</span>
                    <span>ğŸ‘¥ <span id="sv-players" style="color:#d8dde6; font-weight:700;">1</span><span style="color:#5a6475;">/10</span></span>
                    <span style="color:rgba(255,255,255,0.2);">â”‚</span>
                    <button onclick="window.togglePlayerList()" id="btn-jugadores"
                        style="background:linear-gradient(135deg,rgba(120,15,15,0.9),rgba(80,5,5,0.95));
                               color:#ff9090; border:1px solid rgba(200,50,50,0.4); border-radius:6px;
                               padding:3px 10px; cursor:pointer; font-size:11px; font-weight:700;
                               font-family:var(--font-ui); letter-spacing:0.04em; transition:all 0.18s;
                               pointer-events:auto;"
                        onmouseover="this.style.background='linear-gradient(135deg,rgba(180,20,20,0.95),rgba(120,5,5,0.99))';this.style.color='#ffb0b0'"
                        onmouseout="this.style.background='linear-gradient(135deg,rgba(120,15,15,0.9),rgba(80,5,5,0.95))';this.style.color='#ff9090'">
                        âš”ï¸ Jugadores
                    </button>
                </div>

                <!-- Distancia a la costa -->
                <div id="distance-display" style="pointer-events:none;">
                    ğŸ—ºï¸ Costa: <span id="dist-text" style="color:#f5c842;">0m</span>
                </div>

                <!-- HUD de entidades cercanas -->
                <div id="entity-hud" style="display:flex; flex-direction:column; gap:6px; pointer-events:none;"></div>
            </div>

            <!-- â”€â”€ PANEL PVP â€” flotante sobre server-info â”€â”€ -->
            <div id="pvp-player-panel"
                 style="display:none; position:absolute; top:58px; left:14px; z-index:500;
                        pointer-events:auto; width:240px;
                        background:linear-gradient(155deg, rgba(14,4,4,0.97) 0%, rgba(8,2,2,0.99) 100%);
                        border:1px solid rgba(200,50,50,0.35); border-top:2px solid #c0392b;
                        border-radius:0 0 10px 10px; overflow:hidden;
                        box-shadow:0 20px 50px rgba(0,0,0,0.85), 0 0 20px rgba(192,57,43,0.08);">
                <div style="padding:10px 12px 8px; border-bottom:1px solid rgba(200,50,50,0.18); display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-family:var(--font-display); font-size:11px; letter-spacing:0.12em; color:#e07070; text-transform:uppercase;">âš” Duelos</span>
                    <button onclick="window.togglePlayerList()"
                        style="background:transparent; border:none; color:#666; cursor:pointer; font-size:14px; line-height:1; padding:0 2px;"
                        onmouseover="this.style.color='#e07070'" onmouseout="this.style.color='#666'">âœ•</button>
                </div>
                <div id="pvp-player-list-inner" style="padding:8px 10px; max-height:240px; overflow-y:auto;">
                    <div style="color:#5a6475; font-size:12px; text-align:center; padding:12px 0; font-family:var(--font-ui);">Sin jugadores en lÃ­nea</div>
                </div>
            </div>

            <!-- â”€â”€ ARRIBA CENTRO (reloj) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="clock-display">DÃ­a 1 â€” 08:00</div>

            <!-- â”€â”€ ARRIBA DERECHA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div style="position:absolute; top:14px; right:14px; display:flex; flex-direction:column; gap:9px; align-items:flex-end; z-index:200; width:300px;">

                <!-- Botones de menÃº -->
                <div id="top-controls" style="display:flex; gap:5px; pointer-events:auto;">
                    <button class="toggle-btn" onclick="window.openChat()" style="color:#5bb4f5;" title="Chat (Enter)">ğŸ’¬</button>
                    <button class="toggle-btn" onclick="window.toggleChatLog()" style="color:#a478f0;" title="Historial">ğŸ“œ</button>
                    <div style="position:relative; display:inline-block;">
                        <button class="toggle-btn" onclick="window.toggleMenu('inventory')" style="letter-spacing:0.04em;">
                            ğŸ‘¤ Personaje
                        </button>
                        <span id="stat-notif" class="stat-notif">!</span>
                    </div>
                    <button class="toggle-btn" onclick="window.toggleMenu('crafting')" style="letter-spacing:0.04em;">âš’ï¸ Crafteo</button>
                    <button id="btn-help" class="toggle-btn" style="padding:5px 9px; color:var(--gold); border-color:rgba(245,200,66,0.2);">?</button>
                </div>

                <!-- Barras de estado â€” diseÃ±o mejorado -->
                <div id="status-bars" style="pointer-events:auto; width:230px;
                     background:linear-gradient(155deg, rgba(6,10,18,0.95) 0%, rgba(4,7,13,0.98) 100%);
                     backdrop-filter:blur(16px); padding:12px 14px 10px;
                     border-radius:10px; border:1px solid rgba(255,255,255,0.07);
                     box-shadow:0 8px 32px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.04);">

                    <!-- Salud -->
                    <div class="bar-wrapper" style="margin-bottom:8px;">
                        <div class="bar-label" style="margin-bottom:4px;">
                            <span style="color:#e07070;">â¤ Salud</span>
                            <span id="hp-text" style="color:#e07070; font-weight:700;">100/100</span>
                        </div>
                        <div class="bar-container" style="height:9px;">
                            <div id="hp-fill" class="bar-fill" style="width:100%;"></div>
                        </div>
                    </div>

                    <!-- EnergÃ­a -->
                    <div class="bar-wrapper" style="margin-bottom:8px;">
                        <div class="bar-label" style="margin-bottom:4px;">
                            <span style="color:#e0a040;">ğŸ– EnergÃ­a</span>
                            <span id="hunger-text" style="color:#e0a040; font-weight:700;">100/100</span>
                        </div>
                        <div class="bar-container" style="height:9px;">
                            <div id="hunger-fill" class="bar-fill" style="width:100%;"></div>
                        </div>
                    </div>

                    <!-- Separador nivel -->
                    <div style="border-top:1px solid rgba(255,255,255,0.05); margin:8px 0 7px;"></div>

                    <!-- Nivel + XP -->
                    <div class="bar-wrapper">
                        <div class="bar-label" style="margin-bottom:4px;">
                            <span class="level-text-highlight" style="font-size:11px; letter-spacing:0.06em;">â­ NIV. <span id="level-text">1</span></span>
                            <span id="xp-text" style="color:var(--green);">0/100 XP</span>
                        </div>
                        <div class="bar-container" style="height:6px;">
                            <div id="xp-fill" class="bar-fill" style="width:0%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chat log global -->
                <div id="global-chat-log" style="display:flex; flex-direction:column; gap:4px; width:100%; align-items:flex-end; text-align:right; pointer-events:none;"></div>
            </div>

            <!-- â”€â”€ CINTURÃ“N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="toolbar"></div>

            <!-- â”€â”€ CHAT INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="chat-container"
                 style="display:none; position:absolute; bottom:80px; left:50%;
                        transform:translateX(-50%); width:440px; z-index:2000; pointer-events:auto;">
                <input type="text" id="chat-input"
                       placeholder="ğŸ’¬ Escribe un mensajeâ€¦ (Enter para enviar)"
                       autocomplete="off"
                       style="width:100%; padding:11px 18px; border-radius:10px;
                              border:1px solid rgba(61,220,132,0.3);
                              background:rgba(3,6,12,0.97);
                              backdrop-filter:blur(16px);
                              color:#eef2ff;
                              font-family:var(--font-ui);
                              font-size:13px; font-weight:500;
                              outline:none; text-align:center;
                              box-shadow:0 12px 40px rgba(0,0,0,0.8), 0 0 0 1px rgba(61,220,132,0.05);">
            </div>

            <!-- â”€â”€ PROMPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="interaction-prompt"><span id="prompt-text"></span></div>

            <div id="placement-overlay"
                 style="display:none; position:absolute; top:60%; left:50%;
                        transform:translate(-50%,-50%); text-align:center; pointer-events:none;">
                MODO UBICACIÃ“N
                <br>
                <span style="font-family:var(--font-ui); font-size:11px; font-weight:500; color:#5a6475; letter-spacing:0.06em;">
                    Clic Izq: Colocar &nbsp;Â·&nbsp; Clic Der: Cancelar
                </span>
            </div>

            <!-- â”€â”€ TIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div id="game-tips" class="glass-panel"
                 style="display:none; position:absolute; top:70px; left:50%;
                        transform:translateX(-50%); pointer-events:auto; z-index:300;">
                <strong style="color:#f5c842; font-family:var(--font-display); font-size:0.8rem; letter-spacing:0.12em;">
                    CONTROLES
                </strong>
                <br><br>
                <span class="tip-highlight">ENTER</span> Abrir / enviar chat<br>
                <span class="tip-highlight">W / Espacio</span> Saltar / Trepar escalera<br>
                <span class="tip-highlight">F</span> Comer rÃ¡pido<br>
                <span class="tip-highlight">E</span> Interactuar (puertas, cajas, fogatas)<br>
                <span class="tip-highlight">SHIFT</span> + estar adentro = <b style="color:#a478f0;">SIGILO</b><br>
                <span class="tip-highlight">R</span> Cambiar modo martillo<br>
                <span class="tip-highlight">1â€“6</span> Seleccionar cinturÃ³n<br>
                <span class="tip-highlight">Y</span> (mantener) Atraer Ã­tems<br>
                <span class="tip-highlight">/madera /piedra /flechas /escalera /dance</span> Trucos
            </div>



            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!--  MENÃšS EN JUEGO                             -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

            <!-- Inventario / Personaje -->
            <div id="menu-inventory" class="window-menu" style="pointer-events:auto; min-width:420px;">
                <div class="window-header">
                    <h3>ğŸ‘¤ Personaje</h3>
                    <button class="close-btn" onclick="window.toggleMenu('inventory')">âœ•</button>
                </div>
                <div class="inv-split">
                    <div class="inv-left">
                        <div style="font-size:10px; color:#5a6475; margin-bottom:8px; text-align:center; font-family:var(--font-ui); letter-spacing:0.08em; text-transform:uppercase;">
                            Mochila â€” arrastra al cinturÃ³n
                        </div>
                        <div id="inventory-grid"></div>
                    </div>
                    <div class="inv-right">
                        <div class="stat-header">Atributos &nbsp;<span style="color:#5a6475; font-size:0.7rem;">(Puntos: <span id="stat-points">0</span>)</span></div>
                        <div class="stat-row">
                            <span>ğŸ’ª Fuerza</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="stat-str">0</span>
                                <button class="stat-btn" onclick="window.upgradeStat('str')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span>âš¡ Agilidad</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="stat-agi">0</span>
                                <button class="stat-btn" onclick="window.upgradeStat('agi')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span>â¤ï¸ Vitalidad</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="stat-vit">0</span>
                                <button class="stat-btn" onclick="window.upgradeStat('vit')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span>ğŸ¥© Stamina</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="stat-sta">0</span>
                                <button class="stat-btn" onclick="window.upgradeStat('sta')">+</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span>ğŸ§  Intelecto</span>
                            <div style="display:flex; align-items:center;">
                                <span class="stat-val" id="stat-int">0</span>
                                <button class="stat-btn" onclick="window.upgradeStat('int')">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Caja / Cofre -->
            <div id="menu-box" class="window-menu" style="pointer-events:auto;">
                <div class="window-header">
                    <h3 id="box-dynamic-header">ğŸ“¦ Cofre</h3>
                    <button class="close-btn" onclick="window.toggleMenu('box')">âœ•</button>
                </div>
                <div class="inv-split">
                    <div class="inv-left">
                        <div style="font-size:10px; color:#5a6475; margin-bottom:8px; font-family:var(--font-ui); letter-spacing:0.08em; text-transform:uppercase;">Tu mochila</div>
                        <div class="inv-grid" id="box-player-grid"></div>
                    </div>
                    <div class="inv-right">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div style="font-size:10px; color:#5a6475; font-family:var(--font-ui); letter-spacing:0.08em; text-transform:uppercase;">Contenido</div>
                            <button id="btn-take-all-box" class="action-btn mini" style="font-size:10px; padding:3px 8px;" onclick="window.takeAllFromBox()">Agarrar todo</button>
                        </div>
                        <div class="inv-grid" id="box-storage-grid"></div>
                    </div>
                </div>
                <div style="font-size:10px; color:#5a6475; text-align:center; margin-top:8px; font-family:var(--font-ui);">
                    ğŸ–±ï¸ Clic = mover 1 &nbsp;Â·&nbsp; Clic derecho = mover 10
                </div>
            </div>

            <!-- Fogata -->
            <div id="menu-campfire" class="window-menu" style="pointer-events:auto; min-width:260px;">
                <div class="window-header">
                    <h3>ğŸ”¥ Fogata</h3>
                    <button class="close-btn" onclick="window.toggleMenu('campfire')">âœ•</button>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding: 8px 10px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
                    <span style="font-weight:600;">ğŸªµ Madera</span>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <strong id="cf-wood-count" style="color:var(--gold); min-width:20px; text-align:center;">0</strong>
                        <button class="action-btn mini" onclick="window.cfAction('addWood')">+ AÃ±adir</button>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding: 8px 10px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);">
                    <span style="font-weight:600;">ğŸ¥© Carne Cruda</span>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <strong id="cf-meat-count" style="color:var(--gold); min-width:20px; text-align:center;">0</strong>
                        <button class="action-btn mini" onclick="window.cfAction('addMeat')">+ AÃ±adir</button>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; padding: 8px 10px; background: rgba(61,220,132,0.04); border-radius: 6px; border: 1px solid rgba(61,220,132,0.1);">
                    <span style="font-weight:600; color:var(--green);">ğŸ– Carne Asada</span>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <strong id="cf-cooked-count" style="color:var(--green); min-width:20px; text-align:center;">0</strong>
                        <button class="action-btn mini" onclick="window.cfAction('takeCooked')">Recoger</button>
                    </div>
                </div>
                <button id="btn-cf-ignite" class="action-btn"
                        style="border-color:rgba(240,160,48,0.3); color:var(--amber);
                               background:linear-gradient(180deg, rgba(28,16,4,0.92), rgba(18,10,2,0.96));
                               text-shadow: 0 0 12px rgba(240,160,48,0.3);"
                        onclick="window.cfAction('toggleFire')">
                    ğŸ”¥ ENCENDER
                </button>
            </div>

            <!-- Crafteo -->
            <div id="menu-crafting" class="window-menu" style="pointer-events:auto; min-width:340px;">
                <div class="window-header">
                    <h3>âš’ï¸ Mesa de Trabajo</h3>
                    <button class="close-btn" onclick="window.toggleMenu('crafting')">âœ•</button>
                </div>
                <div class="craft-tabs">
                    <button id="btn-tab-herramientas" class="action-btn mini"
                            style="flex:1; border-color:rgba(61,220,132,0.35); color:var(--green);"
                            onclick="window.switchCraftTab('herramientas')">ğŸ› ï¸ Herram.</button>
                    <button id="btn-tab-armas" class="action-btn mini"
                            style="flex:1;"
                            onclick="window.switchCraftTab('armas')">âš”ï¸ Armas</button>
                    <button id="btn-tab-muebles" class="action-btn mini"
                            style="flex:1;"
                            onclick="window.switchCraftTab('muebles')">ğŸ  Muebles</button>
                </div>
                <input type="text" id="craft-search" class="search-bar" placeholder="ğŸ” Buscar recetaâ€¦">
                <div id="craft-list">
                    <div id="tab-herramientas">
                        <div class="craft-item" data-name="antorcha luz">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ”¥ Antorcha</span>
                                <span id="req-torch" class="req-text"></span>
                            </div>
                            <button id="btn-craft-torch" class="action-btn mini">Fabricar Â· 5 Mad. + 2 Tela</button>
                        </div>
                        <div class="craft-item" data-name="hacha">
                            <div class="craft-header">
                                <span class="craft-title">ğŸª“ Hacha</span>
                                <span id="req-axe" class="req-text"></span>
                            </div>
                            <button id="btn-craft-axe" class="action-btn mini">Fabricar Â· 10 Mad.</button>
                        </div>
                        <div class="craft-item" data-name="pico">
                            <div class="craft-header">
                                <span class="craft-title">â›ï¸ Pico</span>
                                <span id="req-pickaxe" class="req-text"></span>
                            </div>
                            <button id="btn-craft-pickaxe" class="action-btn mini">Fabricar Â· 20 Mad.</button>
                        </div>
                        <div class="craft-item" data-name="martillo">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ”¨ Martillo</span>
                                <span id="req-hammer" class="req-text"></span>
                            </div>
                            <button id="btn-craft-hammer" class="action-btn mini">Fabricar Â· 15 Mad.</button>
                        </div>
                    </div>
                    <div id="tab-armas" style="display:none;">
                        <div class="craft-item" data-name="arco">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ¹ Arco Corto</span>
                                <span id="req-bow" class="req-text"></span>
                            </div>
                            <button id="btn-craft-bow" class="action-btn mini">Fabricar Â· 100 Mad. + 2 Tela</button>
                        </div>
                        <div class="craft-item" data-name="espada">
                            <div class="craft-header">
                                <span class="craft-title">âš”ï¸ Espada</span>
                                <span id="req-sword" class="req-text"></span>
                            </div>
                            <button id="btn-craft-sword" class="action-btn mini">Fabricar Â· 30 Mad. + 30 Pie.</button>
                        </div>
                        <div class="craft-item" data-name="flechas municion">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ¯ Flechas</span>
                                <span class="req-text req-text-ok">5 Mad. c/u</span>
                            </div>
                            <div class="craft-actions">
                                <button id="btn-craft-arrow"  class="action-btn mini">Ã—1</button>
                                <button id="btn-craft-arrow2" class="action-btn mini">Ã—2</button>
                                <button id="btn-craft-arrow5" class="action-btn mini">Ã—5</button>
                                <button id="btn-craft-arrow10" class="action-btn mini">Ã—10</button>
                            </div>
                        </div>
                    </div>
                    <div id="tab-muebles" style="display:none;">
                        <div class="craft-item" data-name="caja cofre">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ“¦ Caja</span>
                                <span id="req-box" class="req-text"></span>
                            </div>
                            <button id="btn-craft-box" class="action-btn mini">Fabricar Â· 40 Mad.</button>
                        </div>
                        <div class="craft-item" data-name="fogata fuego">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ”¥ Fogata</span>
                                <span id="req-campfire" class="req-text"></span>
                            </div>
                            <button id="btn-craft-campfire" class="action-btn mini">Fabricar Â· 20 Mad. + 5 Pie.</button>
                        </div>
                        <div class="craft-item" data-name="cama dormir spawn">
                            <div class="craft-header">
                                <span class="craft-title">ğŸ›ï¸ Cama (Respawn)</span>
                                <span id="req-bed" class="req-text"></span>
                            </div>
                            <button id="btn-craft-bed" class="action-btn mini">Fabricar Â· 30 Mad. + 10 Tela</button>
                        </div>
                        <div class="craft-item" data-name="barricada puas trampa defensa">
                            <div class="craft-header">
                                <span class="craft-title">ğŸª¤ Barricada con PÃºas</span>
                                <span id="req-barricade" class="req-text"></span>
                            </div>
                            <button id="btn-craft-barricade" class="action-btn mini">Fabricar Â· 8 Mad. + 4 Pie.</button>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- /ui-layer -->

    </div><!-- /game-wrapper -->
</div><!-- /screen-wrapper -->

<!-- â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
    function resizeGame() {
        const wrapper = document.getElementById('game-wrapper');
        const scale = Math.min(window.innerWidth / 1280, window.innerHeight / 720);
        wrapper.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', resizeGame);
    window.addEventListener('DOMContentLoaded', resizeGame);
</script>

<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<script src="data.js"></script>
<script src="player.js"></script>
<script src="ui.js"></script>
<script src="render.js"></script>
<script src="game.js"></script>

<script>
// ============================================================
//  SISTEMA DE SONIDO â€” Web Audio API, sin archivos externos
//  El AudioContext se precalienta en el primer gesto para
//  eliminar el delay que causa la polÃ­tica de autoplay.
// ============================================================
(function() {
    // Crear el contexto de audio inmediatamente (puede quedar suspendido)
    let _ctx;
    try { _ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) { window.playSound = () => {}; return; }

    let _ready = false;
    const _last = {};
    const THROTTLE = {
        hit_tree:130, hit_rock:110, hit_block:120, hit_entity:90,
        player_hit:180, arrow_shoot:80, arrow_stick:120, arrow_break:100,
        arrow_hit_flesh:100, door:350, pickup:70, craft:400,
        level_up:600, menu_open:200, build:180, eat:500,
        jump:250, land:200, enemy_die:200, tree_fall:300
    };

    // Precalentamiento: en el primer click/tecla, resumir el contexto
    // y reproducir un buffer silencioso para "desbloquear" el sistema
    function warmUp() {
        if (_ready) return;
        _ctx.resume().then(() => {
            // Buffer silencioso de 1 frame para inicializar el pipeline de audio
            const buf = _ctx.createBuffer(1, 1, _ctx.sampleRate);
            const src = _ctx.createBufferSource();
            src.buffer = buf;
            src.connect(_ctx.destination);
            src.start(0);
            _ready = true;
        });
    }
    // Enganchar en los primeros gestos posibles
    ['mousedown','keydown','touchstart','click'].forEach(ev =>
        document.addEventListener(ev, warmUp, { once: false, passive: true })
    );

    // --- Helpers ------------------------------------------------
    function noise(dur) {
        const n = Math.ceil(_ctx.sampleRate * dur);
        const b = _ctx.createBuffer(1, n, _ctx.sampleRate);
        const d = b.getChannelData(0);
        for (let i = 0; i < n; i++) d[i] = Math.random() * 2 - 1;
        return b;
    }
    function gain(vol, dur) {
        const g = _ctx.createGain();
        g.gain.setValueAtTime(vol, _ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, _ctx.currentTime + dur);
        g.connect(_ctx.destination);
        return g;
    }
    function throttled(type) {
        const now = Date.now();
        if (_last[type] && now - _last[type] < (THROTTLE[type] || 80)) return false;
        _last[type] = now;
        return true;
    }

    // --- Motor de sonido ----------------------------------------
    function play(type) {
        if (!_ready || !throttled(type)) return;
        const t = _ctx.currentTime;

        if (type === 'hit_tree') {
            const buf = noise(0.20); const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) { const s=i/_ctx.sampleRate; d[i]=d[i]*Math.exp(-s*26)*0.65+Math.sin(2*Math.PI*110*s)*Math.exp(-s*18)*0.4+Math.sin(2*Math.PI*62*s)*Math.exp(-s*14)*0.28; }
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=820;
            src.connect(lpf); lpf.connect(gain(0.55,0.22)); src.start();

        } else if (type === 'hit_rock') {
            const buf = noise(0.20); const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) { const s=i/_ctx.sampleRate; d[i]=d[i]*Math.exp(-s*50)*0.25+Math.sin(2*Math.PI*700*s)*Math.exp(-s*38)*0.58+Math.sin(2*Math.PI*1280*s)*Math.exp(-s*54)*0.28; }
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const hpf=_ctx.createBiquadFilter(); hpf.type='highpass'; hpf.frequency.value=360;
            src.connect(hpf); hpf.connect(gain(0.48,0.22)); src.start();

        } else if (type === 'hit_block') {
            const buf = noise(0.15); const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) { const s=i/_ctx.sampleRate; d[i]=d[i]*Math.exp(-s*38)*0.62+Math.sin(2*Math.PI*185*s)*Math.exp(-s*22)*0.38; }
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=700;
            src.connect(lpf); lpf.connect(gain(0.40,0.16)); src.start();

        } else if (type === 'hit_entity') {
            const buf = noise(0.12); const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) { const s=i/_ctx.sampleRate; d[i]=d[i]*Math.exp(-s*56)*0.78+Math.sin(2*Math.PI*225*s)*Math.exp(-s*40)*0.28; }
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const bpf=_ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=520; bpf.Q.value=1.4;
            src.connect(bpf); bpf.connect(gain(0.52,0.13)); src.start();

        } else if (type === 'player_hit') {
            const buf = noise(0.24); const d = buf.getChannelData(0);
            for (let i = 0; i < d.length; i++) { const s=i/_ctx.sampleRate; d[i]=d[i]*Math.exp(-s*17)*0.88+Math.sin(2*Math.PI*80*s)*Math.exp(-s*13)*0.48; }
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=760;
            src.connect(lpf); lpf.connect(gain(0.65,0.26)); src.start();

        } else if (type === 'enemy_die') {
            const osc=_ctx.createOscillator(); osc.type='sawtooth';
            osc.frequency.setValueAtTime(250,t); osc.frequency.exponentialRampToValueAtTime(55,t+0.30);
            osc.connect(gain(0.22,0.33)); osc.start(t); osc.stop(t+0.33);

        } else if (type === 'arrow_shoot') {
            const osc=_ctx.createOscillator(); osc.type='sawtooth';
            osc.frequency.setValueAtTime(700,t); osc.frequency.exponentialRampToValueAtTime(2500,t+0.09);
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=3200;
            osc.connect(lpf); lpf.connect(gain(0.16,0.10)); osc.start(t); osc.stop(t+0.10);

        } else if (type === 'arrow_stick') {
            const buf=noise(0.10); const d=buf.getChannelData(0);
            for (let i=0;i<d.length;i++){const s=i/_ctx.sampleRate;d[i]=d[i]*Math.exp(-s*76)*0.52+Math.sin(2*Math.PI*315*s)*Math.exp(-s*50)*0.48;}
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const bpf=_ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=860; bpf.Q.value=2.8;
            src.connect(bpf); bpf.connect(gain(0.38,0.11)); src.start();

        } else if (type === 'arrow_break') {
            const buf=noise(0.07); const d=buf.getChannelData(0);
            for (let i=0;i<d.length;i++) d[i]*=Math.exp(-(i/_ctx.sampleRate)*95)*0.7;
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const hpf=_ctx.createBiquadFilter(); hpf.type='highpass'; hpf.frequency.value=1900;
            src.connect(hpf); hpf.connect(gain(0.26,0.07)); src.start();

        } else if (type === 'arrow_hit_flesh') {
            const buf=noise(0.11); const d=buf.getChannelData(0);
            for (let i=0;i<d.length;i++){const s=i/_ctx.sampleRate;d[i]=d[i]*Math.exp(-s*60)*0.82+Math.sin(2*Math.PI*165*s)*Math.exp(-s*46)*0.20;}
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=1280;
            src.connect(lpf); lpf.connect(gain(0.50,0.11)); src.start();

        } else if (type === 'door') {
            const osc=_ctx.createOscillator(); osc.type='sawtooth';
            osc.frequency.setValueAtTime(340,t); osc.frequency.exponentialRampToValueAtTime(72,t+0.27);
            const buf2=noise(0.27); const d2=buf2.getChannelData(0);
            for(let i=0;i<d2.length;i++) d2[i]*=Math.exp(-(i/_ctx.sampleRate)*14)*0.28;
            const src2=_ctx.createBufferSource(); src2.buffer=buf2;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=600;
            const g=gain(0.28,0.30);
            osc.connect(lpf); lpf.connect(g); src2.connect(g);
            osc.start(t); osc.stop(t+0.30); src2.start(t);

        } else if (type === 'build') {
            [0,0.07].forEach((delay,i)=>{
                const buf=noise(0.10); const d=buf.getChannelData(0);
                for(let j=0;j<d.length;j++){const s=j/_ctx.sampleRate;d[j]=d[j]*Math.exp(-s*44)*0.58+Math.sin(2*Math.PI*(158+i*38)*s)*Math.exp(-s*28)*0.38;}
                const src=_ctx.createBufferSource(); src.buffer=buf;
                const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=880;
                const g=_ctx.createGain(); g.gain.setValueAtTime(0.34,t+delay); g.gain.exponentialRampToValueAtTime(0.0001,t+delay+0.11);
                g.connect(_ctx.destination); src.connect(lpf); lpf.connect(g); src.start(t+delay);
            });

        } else if (type === 'pickup') {
            const osc=_ctx.createOscillator(); osc.type='sine';
            osc.frequency.setValueAtTime(900,t); osc.frequency.setValueAtTime(1350,t+0.04);
            osc.connect(gain(0.18,0.14)); osc.start(t); osc.stop(t+0.14);

        } else if (type === 'craft') {
            [[660,0],[990,0.10]].forEach(([freq,delay])=>{
                const osc=_ctx.createOscillator(); osc.type='triangle'; osc.frequency.value=freq;
                const g=_ctx.createGain(); g.gain.setValueAtTime(0.17,t+delay); g.gain.exponentialRampToValueAtTime(0.0001,t+delay+0.13);
                osc.connect(g); g.connect(_ctx.destination); osc.start(t+delay); osc.stop(t+delay+0.13);
            });

        } else if (type === 'level_up') {
            [[523,0],[659,0.13],[784,0.26],[1047,0.40]].forEach(([freq,delay])=>{
                const osc=_ctx.createOscillator(); osc.type='square'; osc.frequency.value=freq;
                const g=_ctx.createGain(); g.gain.setValueAtTime(0.14,t+delay); g.gain.exponentialRampToValueAtTime(0.0001,t+delay+0.20);
                osc.connect(g); g.connect(_ctx.destination); osc.start(t+delay); osc.stop(t+delay+0.20);
            });

        } else if (type === 'menu_open') {
            const osc=_ctx.createOscillator(); osc.type='sine';
            osc.frequency.setValueAtTime(420,t); osc.frequency.exponentialRampToValueAtTime(660,t+0.09);
            osc.connect(gain(0.11,0.13)); osc.start(t); osc.stop(t+0.13);

        } else if (type === 'eat') {
            [0,0.08,0.16].forEach(delay=>{
                const buf=noise(0.06); const d=buf.getChannelData(0);
                for(let i=0;i<d.length;i++) d[i]*=Math.exp(-(i/_ctx.sampleRate)*78)*0.5;
                const src=_ctx.createBufferSource(); src.buffer=buf;
                const bpf=_ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=580; bpf.Q.value=2;
                const g=_ctx.createGain(); g.gain.setValueAtTime(0.24,t+delay); g.gain.exponentialRampToValueAtTime(0.0001,t+delay+0.06);
                g.connect(_ctx.destination); src.connect(bpf); bpf.connect(g); src.start(t+delay);
            });

        } else if (type === 'jump') {
            const osc=_ctx.createOscillator(); osc.type='sine';
            osc.frequency.setValueAtTime(200,t); osc.frequency.exponentialRampToValueAtTime(420,t+0.12);
            osc.connect(gain(0.09,0.14)); osc.start(t); osc.stop(t+0.14);

        } else if (type === 'land') {
            const buf=noise(0.14); const d=buf.getChannelData(0);
            for(let i=0;i<d.length;i++){const s=i/_ctx.sampleRate;d[i]=d[i]*Math.exp(-s*30)*0.62+Math.sin(2*Math.PI*88*s)*Math.exp(-s*24)*0.32;}
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=660;
            src.connect(lpf); lpf.connect(gain(0.38,0.15)); src.start();

        } else if (type === 'tree_fall') {
            const buf=noise(0.45); const d=buf.getChannelData(0);
            for(let i=0;i<d.length;i++){const s=i/_ctx.sampleRate;const env=s<0.3?Math.exp(-s*5):Math.exp(-(s-0.3)*18)*0.75;d[i]=d[i]*env*0.68+Math.sin(2*Math.PI*52*s)*env*0.48;}
            const src=_ctx.createBufferSource(); src.buffer=buf;
            const lpf=_ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=580;
            src.connect(lpf); lpf.connect(gain(0.55,0.46)); src.start();
        }
    }

    window.playSound = play;

    // --- Hooks automÃ¡ticos en funciones del juego ---------------
    // Esperamos a que los scripts del juego hayan cargado
    window.addEventListener('load', () => {
        // damagePlayer â†’ player_hit
        const _dmg = window.damagePlayer;
        if (_dmg) window.damagePlayer = function(a,s){ play('player_hit'); return _dmg(a,s); };

        // gainXP â†’ level_up si subiÃ³ de nivel
        const _xp = window.gainXP;
        if (_xp) window.gainXP = function(a){ const prev=window.player?window.player.level:0; _xp(a); if(window.player&&window.player.level>prev) play('level_up'); };

        // craftItem â†’ craft
        const _cr = window.craftItem;
        if (_cr) window.craftItem = function(...a){ _cr(...a); play('craft'); };

        // eatFood â†’ eat
        const _eat = window.eatFood;
        if (_eat) window.eatFood = function(...a){ _eat(...a); play('eat'); };

        // sendWorldUpdate â†’ tree_fall / enemy_die
        const _sw = window.sendWorldUpdate;
        if (_sw) window.sendWorldUpdate = function(action, payload){
            if (action==='destroy_tree') play('tree_fall');
            if (action==='kill_entity') play('enemy_die');
            return _sw(action, payload);
        };

        // Salto y aterrizaje via update loop
        const _upd = window.update;
        if (_upd) window.update = function(){
            const wasG = window.player ? window.player.isGrounded : false;
            _upd();
            if (!window.player) return;
            if (!wasG && window.player.isGrounded && (window.player._prevVy||0) > 4) play('land');
            window.player._prevVy = window.player.vy || 0;
        };

        // Tecla de salto
        document.addEventListener('keydown', (e) => {
            if ((e.key===' '||e.key==='w'||e.key==='W') && window.player && window.player.isGrounded && !window.player.isDead)
                play('jump');
        });
    });
})();
</script>

</body>
</html>
